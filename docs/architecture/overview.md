# CodeGen AI ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

> **Version**: 1.0.0
> **Last Updated**: 2026-01-31
> **Author**: ğŸ—ï¸ Architecture Expert Persona
> **Status**: Living Document

---

## ëª©ì°¨

1. [ì‹œìŠ¤í…œ ê°œìš”](#ì‹œìŠ¤í…œ-ê°œìš”)
2. [ì•„í‚¤í…ì²˜ ì›ì¹™](#ì•„í‚¤í…ì²˜-ì›ì¹™)
3. [ì‹œìŠ¤í…œ êµ¬ì„±ë„](#ì‹œìŠ¤í…œ-êµ¬ì„±ë„)
4. [ë ˆì´ì–´ ì•„í‚¤í…ì²˜](#ë ˆì´ì–´-ì•„í‚¤í…ì²˜)
5. [ë°ì´í„° íë¦„](#ë°ì´í„°-íë¦„)
6. [ë³´ì•ˆ ì•„í‚¤í…ì²˜](#ë³´ì•ˆ-ì•„í‚¤í…ì²˜)
7. [í™•ì¥ì„± ê³ ë ¤ì‚¬í•­](#í™•ì¥ì„±-ê³ ë ¤ì‚¬í•­)
8. [ê¸°ìˆ  ê²°ì • ê¸°ë¡ (ADR)](#ê¸°ìˆ -ê²°ì •-ê¸°ë¡)

---

## ì‹œìŠ¤í…œ ê°œìš”

### ë¹„ì „

CodeGen AIëŠ” AI ê¸°ë°˜ì˜ ë§ì¶¤í˜• ì½”ë”© êµìœ¡ ì½˜í…ì¸ ë¥¼ ìë™ ìƒì„±í•˜ëŠ” SaaS í”Œë«í¼ì…ë‹ˆë‹¤.

### í•µì‹¬ ê°€ì¹˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CodeGen AI Core Values                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ğŸ¯ ì‚¬ìš©ì ì¤‘ì‹¬       âš¡ ì„±ëŠ¥ ìš°ì„        ğŸ”’ ë³´ì•ˆ ìµœìš°ì„        â”‚
â”‚  ë§ì¶¤í˜• ì½˜í…ì¸        ë¹ ë¥¸ ì‘ë‹µ ì‹œê°„     ê²°ì œ/ë°ì´í„° ë³´í˜¸     â”‚
â”‚                                                             â”‚
â”‚  ğŸ“ˆ í™•ì¥ ê°€ëŠ¥        ğŸ”§ ìœ ì§€ë³´ìˆ˜ì„±      ğŸŒ ì ‘ê·¼ì„±           â”‚
â”‚  íŠ¸ë˜í”½ ëŒ€ì‘         ì½”ë“œ í’ˆì§ˆ          ëª¨ë“  ì‚¬ìš©ì         â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ê¸°ìˆ  ìŠ¤íƒ ìš”ì•½

| ê³„ì¸µ | ê¸°ìˆ  | ì„ íƒ ì´ìœ  |
|------|------|----------|
| **Frontend** | Next.js 16 + React 19 | SSR/SSG, Server Components |
| **Backend** | Next.js Server Actions | API ê°„ì†Œí™”, íƒ€ì… ì•ˆì „ì„± |
| **Database** | Supabase (PostgreSQL) | RLS, ì‹¤ì‹œê°„, Auth í†µí•© |
| **AI** | Vercel AI SDK + Claude | ìŠ¤íŠ¸ë¦¬ë°, êµ¬ì¡°í™” ì¶œë ¥ |
| **Payment** | TossPayments | êµ­ë‚´ ìµœì í™”, ë¹Œë§ ì§€ì› |
| **Infra** | Vercel + Supabase Cloud | ì„œë²„ë¦¬ìŠ¤, ìë™ ìŠ¤ì¼€ì¼ë§ |

---

## ì•„í‚¤í…ì²˜ ì›ì¹™

### 1. Server-First Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Server-First ì›ì¹™                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  âœ… Server Components ê¸°ë³¸ ì‚¬ìš©                              â”‚
â”‚     â””â”€ ë²ˆë“¤ í¬ê¸° ìµœì†Œí™”, SEO ìµœì í™”                          â”‚
â”‚                                                             â”‚
â”‚  âœ… Client Components ìµœì†Œí™”                                 â”‚
â”‚     â””â”€ ì¸í„°ë™ì…˜ í•„ìš” ì‹œì—ë§Œ 'use client'                     â”‚
â”‚                                                             â”‚
â”‚  âœ… Server Actions í™œìš©                                      â”‚
â”‚     â””â”€ API Route ëŒ€ì‹  Server Actions ìš°ì„                    â”‚
â”‚                                                             â”‚
â”‚  âœ… ë°ì´í„° í˜ì¹­ì€ ì„œë²„ì—ì„œ                                    â”‚
â”‚     â””â”€ í´ë¼ì´ì–¸íŠ¸ ì›Œí„°í´ ë°©ì§€                                â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Security by Design

```yaml
ë³´ì•ˆ ê³„ì¸µ:
  L1 - ë„¤íŠ¸ì›Œí¬:
    - HTTPS ê°•ì œ (HSTS)
    - CSP í—¤ë”
    - CORS ì •ì±…

  L2 - ì¸ì¦/ì¸ê°€:
    - Supabase Auth
    - RLS ì •ì±…
    - CSRF í† í°

  L3 - ë°ì´í„°:
    - AES-256 ì•”í˜¸í™” (ë¹Œë§í‚¤)
    - ë¯¼ê° ì •ë³´ ë§ˆìŠ¤í‚¹
    - í™˜ê²½ ë³€ìˆ˜ ë¶„ë¦¬

  L4 - ì• í”Œë¦¬ì¼€ì´ì…˜:
    - Rate Limiting
    - Input Validation (Zod)
    - SQL Injection ë°©ì§€
```

### 3. ê´€ì‹¬ì‚¬ ë¶„ë¦¬ (Separation of Concerns)

```
src/
â”œâ”€â”€ app/              # ë¼ìš°íŒ… & í˜ì´ì§€ (Presentation)
â”œâ”€â”€ actions/          # ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ (Business Logic)
â”œâ”€â”€ components/       # UI ì»´í¬ë„ŒíŠ¸ (UI)
â”œâ”€â”€ lib/              # ì¸í”„ë¼ & ìœ í‹¸ë¦¬í‹° (Infrastructure)
â”œâ”€â”€ hooks/            # í´ë¼ì´ì–¸íŠ¸ ìƒíƒœ (Client State)
â””â”€â”€ types/            # íƒ€ì… ì •ì˜ (Type Definitions)
```

---

## ì‹œìŠ¤í…œ êµ¬ì„±ë„

### High-Level Architecture

```
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚   CDN (Vercel)   â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                        â”‚                        â”‚
                    â–¼                        â–¼                        â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   Browser    â”‚        â”‚   Mobile     â”‚        â”‚   API        â”‚
            â”‚   (React)    â”‚        â”‚   (PWA)      â”‚        â”‚   Clients    â”‚
            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚                       â”‚                        â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                                           â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚    Vercel Edge        â”‚
                              â”‚    (Middleware)       â”‚
                              â”‚    - Auth Check       â”‚
                              â”‚    - Rate Limit       â”‚
                              â”‚    - Redirects        â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚                      â”‚                      â”‚
                   â–¼                      â–¼                      â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚   Pages      â”‚      â”‚   Server     â”‚      â”‚   API        â”‚
          â”‚   (RSC)      â”‚      â”‚   Actions    â”‚      â”‚   Routes     â”‚
          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚                     â”‚                      â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                        â”‚                        â”‚
              â–¼                        â–¼                        â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  Supabase    â”‚        â”‚  AI APIs     â”‚        â”‚ TossPayments â”‚
     â”‚  - Database  â”‚        â”‚  - Claude    â”‚        â”‚  - ê²°ì œ API  â”‚
     â”‚  - Auth      â”‚        â”‚  - GPT-4o    â”‚        â”‚  - ë¹Œë§ API  â”‚
     â”‚  - Storage   â”‚        â”‚  (Fallback)  â”‚        â”‚  - ì›¹í›…      â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Component Interaction

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Component Interaction Flow                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚   Page      â”‚â”€â”€â”€â”€â–¶â”‚   Server    â”‚â”€â”€â”€â”€â–¶â”‚   Supabase  â”‚               â”‚
â”‚  â”‚ (RSC)       â”‚     â”‚   Action    â”‚     â”‚   Client    â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚         â”‚                   â”‚                                           â”‚
â”‚         â”‚                   â”‚  Validation (Zod)                        â”‚
â”‚         â”‚                   â”‚  Rate Limit Check                        â”‚
â”‚         â”‚                   â”‚  Auth Check                              â”‚
â”‚         â”‚                   â”‚                                           â”‚
â”‚         â–¼                   â–¼                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚   Client    â”‚â—€â”€â”€â”€â–¶â”‚   AI SDK    â”‚â”€â”€â”€â”€â–¶â”‚   Claude    â”‚               â”‚
â”‚  â”‚ Component   â”‚     â”‚  streamText â”‚     â”‚   API       â”‚               â”‚
â”‚  â”‚ (Streaming) â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ë ˆì´ì–´ ì•„í‚¤í…ì²˜

### Presentation Layer (app/)

```typescript
// ì—­í• : ë¼ìš°íŒ…, ë ˆì´ì•„ì›ƒ, í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸
// ì›ì¹™: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ìµœì†Œí™”, ë Œë”ë§ì— ì§‘ì¤‘

app/
â”œâ”€â”€ (auth)/              # ì¸ì¦ ê·¸ë£¹
â”‚   â”œâ”€â”€ login/page.tsx   # ë¡œê·¸ì¸ í˜ì´ì§€
â”‚   â””â”€â”€ register/page.tsx
â”‚
â”œâ”€â”€ (protected)/         # ì¸ì¦ í•„ìˆ˜ ê·¸ë£¹
â”‚   â”œâ”€â”€ layout.tsx       # ì¸ì¦ ì²´í¬ ë ˆì´ì•„ì›ƒ
â”‚   â”œâ”€â”€ dashboard/       # ëŒ€ì‹œë³´ë“œ
â”‚   â”œâ”€â”€ generate/        # AI ìƒì„±
â”‚   â””â”€â”€ settings/        # ì„¤ì •
â”‚
â”œâ”€â”€ (marketing)/         # í¼ë¸”ë¦­ ê·¸ë£¹
â”‚   â”œâ”€â”€ page.tsx         # ëœë”© í˜ì´ì§€
â”‚   â””â”€â”€ pricing/
â”‚
â””â”€â”€ api/                 # API Routes (ì›¹í›… ì „ìš©)
    â””â”€â”€ webhooks/
        â””â”€â”€ toss/route.ts
```

### Business Logic Layer (actions/)

```typescript
// ì—­í• : ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§, ë°ì´í„° ë³€í™˜
// ì›ì¹™: ìˆœìˆ˜ í•¨ìˆ˜, í…ŒìŠ¤íŠ¸ ê°€ëŠ¥, ì¬ì‚¬ìš© ê°€ëŠ¥

actions/
â”œâ”€â”€ auth.ts              # ì¸ì¦ ê´€ë ¨ ì•¡ì…˜
â”‚   â”œâ”€â”€ login()
â”‚   â”œâ”€â”€ register()
â”‚   â””â”€â”€ logout()
â”‚
â”œâ”€â”€ generate.ts          # AI ìƒì„± ì•¡ì…˜
â”‚   â”œâ”€â”€ generateContent()
â”‚   â””â”€â”€ generateContentStreaming()
â”‚
â”œâ”€â”€ payment.ts           # ê²°ì œ ì•¡ì…˜
â”‚   â”œâ”€â”€ preparePayment()
â”‚   â””â”€â”€ confirmCreditPayment()
â”‚
â””â”€â”€ subscription.ts      # êµ¬ë… ì•¡ì…˜
    â”œâ”€â”€ prepareSubscription()
    â””â”€â”€ cancelSubscription()
```

### Infrastructure Layer (lib/)

```typescript
// ì—­í• : ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—°ë™, ìœ í‹¸ë¦¬í‹°
// ì›ì¹™: ì¶”ìƒí™”, ì¬ì‚¬ìš©, í…ŒìŠ¤íŠ¸ ìš©ì´

lib/
â”œâ”€â”€ supabase/            # ë°ì´í„°ë² ì´ìŠ¤
â”‚   â”œâ”€â”€ client.ts        # ë¸Œë¼ìš°ì € í´ë¼ì´ì–¸íŠ¸
â”‚   â”œâ”€â”€ server.ts        # ì„œë²„ í´ë¼ì´ì–¸íŠ¸
â”‚   â””â”€â”€ admin.ts         # ì„œë¹„ìŠ¤ ë¡¤ í´ë¼ì´ì–¸íŠ¸
â”‚
â”œâ”€â”€ ai/                  # AI í†µí•©
â”‚   â”œâ”€â”€ providers.ts     # AI ëª¨ë¸ ì„¤ì •
â”‚   â”œâ”€â”€ prompts.ts       # í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿
â”‚   â””â”€â”€ schemas.ts       # ì¶œë ¥ ìŠ¤í‚¤ë§ˆ (Zod)
â”‚
â”œâ”€â”€ payment/             # ê²°ì œ
â”‚   â”œâ”€â”€ toss.ts          # TossPayments í´ë¼ì´ì–¸íŠ¸
â”‚   â””â”€â”€ crypto.ts        # ì•”í˜¸í™” ìœ í‹¸
â”‚
â””â”€â”€ validators/          # ê²€ì¦
    â””â”€â”€ payment.ts       # ê²°ì œ ì…ë ¥ ê²€ì¦
```

---

## ë°ì´í„° íë¦„

### AI ì½˜í…ì¸  ìƒì„± í”Œë¡œìš°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AI Content Generation Flow                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  1. ì‚¬ìš©ì ì…ë ¥                                                          â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚     â”‚ { language: 'Python', topic: 'ë¦¬ìŠ¤íŠ¸', difficulty: 'beginner' }â”‚   â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                          â”‚
â”‚                              â–¼                                          â”‚
â”‚  2. Server Action (generateContentStreaming)                            â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚     â”‚ âœ“ ì¸ì¦ í™•ì¸ (auth())                                           â”‚   â”‚
â”‚     â”‚ âœ“ Rate Limit ì²´í¬ (checkRateLimit)                            â”‚   â”‚
â”‚     â”‚ âœ“ í¬ë ˆë”§/íšŸìˆ˜ í™•ì¸ (use_credit_atomic)                         â”‚   â”‚
â”‚     â”‚ âœ“ ì…ë ¥ ê²€ì¦ (Zod schema)                                       â”‚   â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                          â”‚
â”‚                              â–¼                                          â”‚
â”‚  3. AI SDK í˜¸ì¶œ (streamText)                                           â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚     â”‚ model: claude-sonnet-4                                         â”‚   â”‚
â”‚     â”‚ system: CONTENT_SYSTEM_PROMPT                                  â”‚   â”‚
â”‚     â”‚ prompt: createContentPrompt(input)                             â”‚   â”‚
â”‚     â”‚ maxTokens: 4000, temperature: 0.7                              â”‚   â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                          â”‚
â”‚                              â–¼ (ìŠ¤íŠ¸ë¦¬ë°)                               â”‚
â”‚  4. í´ë¼ì´ì–¸íŠ¸ ë Œë”ë§                                                   â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚     â”‚ for await (const chunk of stream) {                           â”‚   â”‚
â”‚     â”‚   setContent(prev => prev + chunk);  // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸        â”‚   â”‚
â”‚     â”‚ }                                                              â”‚   â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                          â”‚
â”‚                              â–¼                                          â”‚
â”‚  5. ì €ì¥ & ì™„ë£Œ                                                         â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚     â”‚ âœ“ generated_contents í…Œì´ë¸”ì— ì €ì¥                             â”‚   â”‚
â”‚     â”‚ âœ“ ì‚¬ìš©ëŸ‰ ê¸°ë¡ (tokens_used, generation_time_ms)               â”‚   â”‚
â”‚     â”‚ âœ“ íˆìŠ¤í† ë¦¬ í˜ì´ì§€ì—ì„œ ì¡°íšŒ ê°€ëŠ¥                                 â”‚   â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ê²°ì œ ì²˜ë¦¬ í”Œë¡œìš°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Payment Processing Flow                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  Phase 1: ê²°ì œ ì¤€ë¹„ (preparePayment)                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Client                    Server                    Database    â”‚   â”‚
â”‚  â”‚   â”‚                         â”‚                          â”‚        â”‚   â”‚
â”‚  â”‚   â”‚â”€â”€â”€ packageId â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                          â”‚        â”‚   â”‚
â”‚  â”‚   â”‚                         â”‚â”€â”€â”€ ê¸ˆì•¡ ì¡°íšŒ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚        â”‚   â”‚
â”‚  â”‚   â”‚                         â”‚â—€â”€â”€ íŒ¨í‚¤ì§€ ì •ë³´ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚        â”‚   â”‚
â”‚  â”‚   â”‚                         â”‚â”€â”€â”€ payments INSERT â”€â”€â”€â”€â–¶â”‚        â”‚   â”‚
â”‚  â”‚   â”‚â—€â”€â”€ orderId, amount â”€â”€â”€â”€â”‚                          â”‚        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  Phase 2: í† ìŠ¤í˜ì´ë¨¼ì¸  ê²°ì œ (í´ë¼ì´ì–¸íŠ¸)                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Client                    TossPayments                          â”‚   â”‚
â”‚  â”‚   â”‚                         â”‚                                   â”‚   â”‚
â”‚  â”‚   â”‚â”€â”€â”€ requestPayment() â”€â”€â”€â–¶â”‚  ê²°ì œì°½ í‘œì‹œ                       â”‚   â”‚
â”‚  â”‚   â”‚                         â”‚  ì‚¬ìš©ì ê²°ì œ ì§„í–‰                  â”‚   â”‚
â”‚  â”‚   â”‚â—€â”€â”€ paymentKey â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  Phase 3: ê²°ì œ í™•ì¸ (confirmCreditPayment)                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Client         Server           TossAPI          Database       â”‚   â”‚
â”‚  â”‚   â”‚              â”‚                 â”‚                â”‚           â”‚   â”‚
â”‚  â”‚   â”‚â”€ paymentKey â–¶â”‚                 â”‚                â”‚           â”‚   â”‚
â”‚  â”‚   â”‚   orderId    â”‚â”€ ê¸ˆì•¡ ê²€ì¦ â”€â”€â”€â”€â–¶â”‚                â”‚           â”‚   â”‚
â”‚  â”‚   â”‚   amount     â”‚                 â”‚                â”‚           â”‚   â”‚
â”‚  â”‚   â”‚              â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚           â”‚   â”‚
â”‚  â”‚   â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€ confirm â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚           â”‚   â”‚
â”‚  â”‚   â”‚              â”‚                 â”‚                â”‚           â”‚   â”‚
â”‚  â”‚   â”‚              â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€ ê²°ì œ ìŠ¹ì¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚           â”‚   â”‚
â”‚  â”‚   â”‚              â”‚â”€â”€â”€ RPC: confirm_credit_atomic â”€â”€â–¶â”‚           â”‚   â”‚
â”‚  â”‚   â”‚              â”‚    (payments UPDATE + credits ADD)â”‚           â”‚   â”‚
â”‚  â”‚   â”‚â—€â”€ success â”€â”€â”‚                 â”‚                â”‚           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ë³´ì•ˆ ì•„í‚¤í…ì²˜

### ì¸ì¦ í”Œë¡œìš°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Authentication Flow                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  Client  â”‚â”€â”€â”€â–¶â”‚Middlewareâ”‚â”€â”€â”€â–¶â”‚  Server  â”‚â”€â”€â”€â–¶â”‚ Supabase â”‚         â”‚
â”‚  â”‚          â”‚    â”‚          â”‚    â”‚  Action  â”‚    â”‚   Auth   â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚       â”‚               â”‚               â”‚               â”‚                â”‚
â”‚       â”‚               â”‚               â”‚               â”‚                â”‚
â”‚  1. Request      2. Cookie       3. Session      4. User              â”‚
â”‚     with            Check           Verify          Data               â”‚
â”‚     Cookie                                                             â”‚
â”‚                                                                         â”‚
â”‚  Protected Route Flow:                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 1. Middleware: ì¿ í‚¤ì—ì„œ ì„¸ì…˜ í† í° í™•ì¸                           â”‚   â”‚
â”‚  â”‚ 2. ì„¸ì…˜ ì—†ìŒ â†’ /login?redirectTo={originalUrl}                   â”‚   â”‚
â”‚  â”‚ 3. ì„¸ì…˜ ìˆìŒ â†’ ìš”ì²­ ê³„ì† ì§„í–‰                                     â”‚   â”‚
â”‚  â”‚ 4. Server Action: createServerClient()ë¡œ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ        â”‚   â”‚
â”‚  â”‚ 5. RLS: user_id = auth.uid() ì¡°ê±´ìœ¼ë¡œ ë°ì´í„° í•„í„°ë§              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Row Level Security (RLS)

```sql
-- ì‚¬ìš©ìëŠ” ìì‹ ì˜ ë°ì´í„°ë§Œ ì¡°íšŒ/ìˆ˜ì • ê°€ëŠ¥
CREATE POLICY "Users can view own data"
    ON profiles FOR SELECT
    USING (auth.uid() = id);

CREATE POLICY "Users can update own profile"
    ON profiles FOR UPDATE
    USING (auth.uid() = id);

-- ìƒì„±ëœ ì½˜í…ì¸ ëŠ” ìì‹ ì˜ ê²ƒë§Œ ì ‘ê·¼
CREATE POLICY "Users can manage own contents"
    ON generated_contents FOR ALL
    USING (auth.uid() = user_id);

-- ê²°ì œ ì •ë³´ëŠ” ì¡°íšŒë§Œ ê°€ëŠ¥ (ìˆ˜ì •ì€ ì„œë²„ì—ì„œë§Œ)
CREATE POLICY "Users can view own payments"
    ON payments FOR SELECT
    USING (auth.uid() = user_id);

-- ë¹Œë§í‚¤ëŠ” ë§ˆìŠ¤í‚¹ëœ ì •ë³´ë§Œ ì¡°íšŒ
CREATE POLICY "Users can view own billing keys (masked)"
    ON billing_keys FOR SELECT
    USING (auth.uid() = user_id);
```

---

## í™•ì¥ì„± ê³ ë ¤ì‚¬í•­

### ìˆ˜í‰ í™•ì¥ ì „ëµ

```
í˜„ì¬ (1,000 MAU)          ì¤‘ê¸° (10,000 MAU)         ì¥ê¸° (100,000+ MAU)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Vercel (Single)  â”‚      â”‚ Vercel (Edge)    â”‚      â”‚ Multi-Region     â”‚
â”‚                  â”‚  â†’   â”‚ + Edge Functions â”‚  â†’   â”‚ + CDN Sharding   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Supabase Free    â”‚      â”‚ Supabase Pro     â”‚      â”‚ Supabase +       â”‚
â”‚                  â”‚  â†’   â”‚ + Connection Poolâ”‚  â†’   â”‚ Read Replicas    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Memory Rate Limitâ”‚      â”‚ Vercel KV        â”‚      â”‚ Redis Cluster    â”‚
â”‚                  â”‚  â†’   â”‚                  â”‚  â†’   â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ìºì‹± ì „ëµ

```typescript
// 1. Static Generation (ì •ì  í˜ì´ì§€)
// app/(marketing)/pricing/page.tsx
export const revalidate = 3600; // 1ì‹œê°„ë§ˆë‹¤ ì¬ìƒì„±

// 2. Edge Caching (API ì‘ë‹µ)
// Cache-Control: public, s-maxage=60, stale-while-revalidate

// 3. Client-side Caching (TanStack Query - í–¥í›„)
// const { data } = useQuery({
//   queryKey: ['user', userId],
//   queryFn: () => getUser(userId),
//   staleTime: 5 * 60 * 1000, // 5ë¶„
// });

// 4. Database Caching (Supabase)
// ì¸ë±ìŠ¤ ìµœì í™”, ì¿¼ë¦¬ ìºì‹±
```

---

## ê¸°ìˆ  ê²°ì • ê¸°ë¡

### ADR-001: Supabase ì„ íƒ

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ìƒíƒœ** | Accepted |
| **ì¼ì** | 2026-01-20 |
| **ì»¨í…ìŠ¤íŠ¸** | ë°±ì—”ë“œ ë°ì´í„°ë² ì´ìŠ¤ ë° ì¸ì¦ ì‹œìŠ¤í…œ ì„ íƒ í•„ìš” |
| **ê²°ì •** | Supabase (PostgreSQL + Auth + RLS) |
| **ëŒ€ì•ˆ** | Firebase, PlanetScale, Neon |
| **ì´ìœ ** | - PostgreSQL ê¸°ë°˜ìœ¼ë¡œ ë³µì¡í•œ ì¿¼ë¦¬ ì§€ì›<br>- RLSë¡œ í–‰ ë‹¨ìœ„ ë³´ì•ˆ êµ¬í˜„<br>- Auth í†µí•©ìœ¼ë¡œ ê°œë°œ ì‹œê°„ ë‹¨ì¶•<br>- í•œêµ­ì–´ ì§€ì› ë° ì•„ì‹œì•„ ë¦¬ì „ |
| **ê²°ê³¼** | ë³´ì•ˆ ê°•í™”, ê°œë°œ ì†ë„ í–¥ìƒ |

### ADR-002: Vercel AI SDK ì±„íƒ

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ìƒíƒœ** | Accepted |
| **ì¼ì** | 2026-01-22 |
| **ì»¨í…ìŠ¤íŠ¸** | AI ëª¨ë¸ í†µí•© ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„ íƒ |
| **ê²°ì •** | Vercel AI SDK 4.0 |
| **ëŒ€ì•ˆ** | ì§ì ‘ API í˜¸ì¶œ, LangChain |
| **ì´ìœ ** | - ìŠ¤íŠ¸ë¦¬ë° ì§€ì› ë‚´ì¥<br>- Zod ìŠ¤í‚¤ë§ˆë¡œ êµ¬ì¡°í™” ì¶œë ¥<br>- ë‹¤ì¤‘ ëª¨ë¸ ì§€ì›<br>- Next.jsì™€ ì™„ë²½ í†µí•© |
| **ê²°ê³¼** | ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° UI êµ¬í˜„, íƒ€ì… ì•ˆì „ì„± í™•ë³´ |

### ADR-003: TossPayments ì„ íƒ

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ìƒíƒœ** | Accepted |
| **ì¼ì** | 2026-01-25 |
| **ì»¨í…ìŠ¤íŠ¸** | í•œêµ­ ê²°ì œ ì‹œìŠ¤í…œ í†µí•© |
| **ê²°ì •** | TossPayments |
| **ëŒ€ì•ˆ** | Stripe, NicePay, KGì´ë‹ˆì‹œìŠ¤ |
| **ì´ìœ ** | - êµ­ë‚´ ê²°ì œ ìˆ˜ë‹¨ ìµœì í™”<br>- ë¹Œë§í‚¤ ì •ê¸°ê²°ì œ ì§€ì›<br>- ê°œë°œì ì¹œí™”ì  API<br>- í…ŒìŠ¤íŠ¸ í™˜ê²½ ìš°ìˆ˜ |
| **ê²°ê³¼** | ì•ˆì •ì ì¸ ê²°ì œ ì‹œìŠ¤í…œ êµ¬ì¶• |

### ADR-004: Server Actions ìš°ì„  ì‚¬ìš©

| í•­ëª© | ë‚´ìš© |
|------|------|
| **ìƒíƒœ** | Accepted |
| **ì¼ì** | 2026-01-26 |
| **ì»¨í…ìŠ¤íŠ¸** | API ë ˆì´ì–´ ì„¤ê³„ ë°©ì‹ ê²°ì • |
| **ê²°ì •** | API Routes ëŒ€ì‹  Server Actions ìš°ì„  ì‚¬ìš© |
| **ëŒ€ì•ˆ** | REST API Routes, tRPC |
| **ì´ìœ ** | - íƒ€ì… ì•ˆì „ì„± (ì…ì¶œë ¥ íƒ€ì… ê³µìœ )<br>- ì½”ë“œ ê°„ì†Œí™” (ë³„ë„ API ë¶ˆí•„ìš”)<br>- í¼ í†µí•© ìš©ì´<br>- Progressive Enhancement |
| **ê²°ê³¼** | ê°œë°œ ì†ë„ í–¥ìƒ, ì½”ë“œëŸ‰ ê°ì†Œ |
| **ì˜ˆì™¸** | ì›¹í›…ì€ API Routes ì‚¬ìš© (ì™¸ë¶€ í˜¸ì¶œ í•„ìš”) |

---

## ëª¨ë‹ˆí„°ë§ & ê´€ì¸¡ì„±

### ë¡œê¹… ì „ëµ

```typescript
// ë¡œê·¸ ë ˆë²¨ ì •ì˜
enum LogLevel {
  DEBUG = 'debug',   // ê°œë°œ í™˜ê²½ì—ì„œë§Œ
  INFO = 'info',     // ì¼ë°˜ ì •ë³´
  WARN = 'warn',     // ê²½ê³  (ì£¼ì˜ í•„ìš”)
  ERROR = 'error',   // ì˜¤ë¥˜ (ì¦‰ì‹œ ëŒ€ì‘)
}

// ë¡œê·¸ í¬ë§·
interface LogEntry {
  timestamp: string;
  level: LogLevel;
  message: string;
  context?: {
    userId?: string;
    action?: string;
    duration?: number;
    [key: string]: unknown;
  };
}

// ë¯¼ê° ì •ë³´ ë§ˆìŠ¤í‚¹
const SENSITIVE_FIELDS = [
  'password', 'token', 'secret', 'billingKey',
  'cardNumber', 'cvv', 'apiKey'
];
```

### ë©”íŠ¸ë¦­ ìˆ˜ì§‘

```yaml
ë¹„ì¦ˆë‹ˆìŠ¤ ë©”íŠ¸ë¦­:
  - ì¼ì¼ ì½˜í…ì¸  ìƒì„± ìˆ˜
  - ê²°ì œ ì„±ê³µ/ì‹¤íŒ¨ìœ¨
  - ì‚¬ìš©ì ë¦¬í…ì…˜
  - í¬ë ˆë”§ ì†Œë¹„ íŒ¨í„´

ê¸°ìˆ  ë©”íŠ¸ë¦­:
  - API ì‘ë‹µ ì‹œê°„ (p50, p95, p99)
  - ì—ëŸ¬ìœ¨
  - Rate Limit ì´ˆê³¼ íšŸìˆ˜
  - AI í† í° ì‚¬ìš©ëŸ‰

ì¸í”„ë¼ ë©”íŠ¸ë¦­:
  - Vercel Function Duration
  - Supabase Connection Pool
  - Edge ìºì‹œ íˆíŠ¸ìœ¨
```

---

## ì°¸ê³  ìë£Œ

### ë‚´ë¶€ ë¬¸ì„œ

- [Database Schema](./database-schema.md)
- [API Documentation](./api/)
- [Security Guide](./security/)
- [Deployment Guide](./deployment.md)

### ì™¸ë¶€ ì°¸ê³ 

- [Next.js App Router](https://nextjs.org/docs/app)
- [Vercel AI SDK](https://sdk.vercel.ai/docs)
- [Supabase Docs](https://supabase.com/docs)
- [TossPayments Docs](https://docs.tosspayments.com)

---

*ì´ ë¬¸ì„œëŠ” ì‹œìŠ¤í…œ ë³€ê²½ì— ë”°ë¼ ì§€ì†ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.*
